<div class="scoreboard-container">
  <!-- Header -->
  <div class="scoreboard-header">
    <h1><fa-icon [icon]="faTrophy"></fa-icon> Scoreboard</h1>
    <p class="subtitle">Compite con otros usuarios y escala posiciones</p>
  </div>

  <!-- User Stats Card -->
  <div class="user-stats-card" *ngIf="userStats">
    <div class="stats-header">
      <h2>Tus Estadísticas</h2>
      <div class="user-rank" *ngIf="currentUserRank">
        <span class="rank-label">Tu posición:</span>
        <span class="rank-number">#{{ currentUserRank }}</span>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-icon"><fa-icon [icon]="faStar"></fa-icon></div>
        <div class="stat-content">
          <div class="stat-value">{{ formatScore(userStats.totalPoints) }}</div>
          <div class="stat-label">Puntos Totales</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><fa-icon [icon]="faBullseye"></fa-icon></div>
        <div class="stat-content">
          <div class="stat-value">{{ userStats.totalScans }}</div>
          <div class="stat-label">Escaneos</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><fa-icon [icon]="faBug"></fa-icon></div>
        <div class="stat-content">
          <div class="stat-value">{{ userStats.totalVulnerabilities }}</div>
          <div class="stat-label">Vulnerabilidades</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><fa-icon [icon]="faChartBar"></fa-icon></div>
        <div class="stat-content">
          <div class="stat-value">{{ formatScore(userStats.avgScore) }}</div>
          <div class="stat-label">Promedio</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><fa-icon [icon]="faMedal"></fa-icon></div>
        <div class="stat-content">
          <div class="stat-value">{{ formatScore(userStats.bestScore) }}</div>
          <div class="stat-label">Mejor Puntaje</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><fa-icon [icon]="faChartLine"></fa-icon></div>
        <div class="stat-content">
          <div class="stat-value">Nivel {{ userStats.level }}</div>
          <div class="stat-label">Nivel Actual</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Timeframe Selector -->
  <div class="timeframe-selector">
    <button 
      class="timeframe-btn" 
      [class.active]="timeframe === 'all'"
      (click)="changeTimeframe('all')">
      Todo el tiempo
    </button>
    <button 
      class="timeframe-btn" 
      [class.active]="timeframe === 'month'"
      (click)="changeTimeframe('month')">
      Este mes
    </button>
    <button 
      class="timeframe-btn" 
      [class.active]="timeframe === 'week'"
      (click)="changeTimeframe('week')">
      Esta semana
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando scoreboard...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error && !loading">
    <div class="error-icon"><fa-icon [icon]="faExclamationTriangle"></fa-icon></div>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadScoreboard()">Reintentar</button>
  </div>

  <!-- Scoreboard Table -->
  <div class="scoreboard-table" *ngIf="!loading && !error">
    <div class="table-header">
      <div class="col-rank">Posición</div>
      <div class="col-user">Usuario</div>
      <div class="col-level">Nivel</div>
      <div class="col-points">Puntos</div>
      <div class="col-scans">Escaneos</div>
      <div class="col-vulns">Vulnerabilidades</div>
      <div class="col-avg">Promedio</div>
      <div class="col-best">Mejor</div>
    </div>

    <div class="table-body">
      <div 
        *ngFor="let entry of scoreboard; let i = index" 
        class="table-row"
        [class.highlight]="entry.rank === currentUserRank">
        
        <!-- Rank -->
        <div class="col-rank">
          <span class="rank-badge" [class.medal]="entry.rank <= 3">
            <span *ngIf="entry.rank <= 3" class="medal-icon">{{ getMedalIcon(entry.rank) }}</span>
            <span *ngIf="entry.rank > 3">{{ entry.rank }}</span>
          </span>
        </div>

        <!-- User -->
        <div class="col-user">
          <div class="user-info">
            <div class="avatar">
              <img [src]="getAvatarPath(entry.avatarId)" [alt]="entry.username" />
            </div>
            <div class="username">
              {{ entry.username }}
              <span class="you-badge" *ngIf="entry.rank === currentUserRank">Tú</span>
            </div>
          </div>
        </div>

        <!-- Level -->
        <div class="col-level">
          <span class="level-badge">Nivel {{ entry.level }}</span>
        </div>

        <!-- Points -->
        <div class="col-points">
          <span class="points-value">{{ formatScore(entry.totalPoints) }}</span>
        </div>

        <!-- Scans -->
        <div class="col-scans">
          {{ entry.totalScans }}
        </div>

        <!-- Vulnerabilities -->
        <div class="col-vulns">
          {{ entry.totalVulnerabilities }}
        </div>

        <!-- Average -->
        <div class="col-avg">
          {{ formatScore(entry.avgScore) }}
        </div>

        <!-- Best Score -->
        <div class="col-best">
          <span class="best-score">{{ formatScore(entry.bestScore) }}</span>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="scoreboard.length === 0">
      <div class="empty-icon"><fa-icon [icon]="faChartBar"></fa-icon></div>
      <h3>No hay datos disponibles</h3>
      <p>Completa algunos escaneos para aparecer en el scoreboard</p>
    </div>
  </div>
</div>
